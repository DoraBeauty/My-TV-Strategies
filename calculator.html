<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dora Beauty è²»ç”¨è©¦ç®—ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: #fdfaf0;
            margin: 0; padding: 0;
            overscroll-behavior-y: contain;
            overflow-x: hidden; /* é˜²æ­¢æ„›å¿ƒé£„å‡ºç”¢ç”Ÿå·è»¸ */
        }
        .tap:active { transform: scale(0.97); transition: 0.1s; }
        .glass-card { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); }
        .loader {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #d97706;
            border-radius: 50%;
            width: 20px; height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block; vertical-align: middle; margin-right: 8px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Modal å‹•ç•«èˆ‡æ¨£å¼ */
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        .modal-animate { animation: modalFadeIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .form-input {
            width: 100%;
            box-sizing: border-box; /* æ ¸å¿ƒä¿®æ­£ï¼šçµ±ä¸€ç›’æ¨¡å‹è¨ˆç®— */
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 0.75rem;
            font-size: 0.95rem;
            color: #334155;
            outline: none;
            transition: all 0.2s;
            margin: 0; /* ä¿®æ­£ï¼šç§»é™¤é è¨­å¤–è· */
            -webkit-appearance: none; /* ä¿®æ­£ï¼šç§»é™¤ iOS é è¨­æ¨£å¼ */
            appearance: none;
        }
        .form-input:focus {
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
            background-color: #fff;
        }
        .form-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 700;
            color: #475569;
            margin-bottom: 0.4rem;
        }
        .section-title {
            font-size: 1rem;
            font-weight: 900;
            color: #d97706;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        /* éš±è— Scrollbar ä½†ä¿æŒæ²å‹• */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Logo ç‰¹æ•ˆå‹•ç•« */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .logo-float { animation: float 6s ease-in-out infinite; }

        /* å½©è›‹æ„›å¿ƒé£„æµ®å‹•ç•« */
        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg) scale(0.5); opacity: 0; }
            10% { opacity: 1; transform: translateY(-20px) rotate(10deg) scale(1); }
            100% { transform: translateY(-100vh) rotate(360deg) scale(1.2); opacity: 0; }
        }
        .heart-particle {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            animation: floatUp 4s ease-in forwards;
            font-size: 1.5rem;
        }
        /* é¼“å‹µå°èª Toast */
        .toast-enter { transform: translateY(20px); opacity: 0; }
        .toast-enter-active { transform: translateY(0); opacity: 1; transition: all 0.3s ease-out; }
        .toast-exit { transform: translateY(0); opacity: 1; }
        .toast-exit-active { transform: translateY(-20px); opacity: 0; transition: all 0.3s ease-in; }

        /* è‡ªå®šç¾©æ»‘å…¥å‹•ç•« (æ›¿ä»£ tailwindcss-animate) */
        @keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-slide-up { animation: fadeSlideUp 0.5s ease-out forwards; }
    </style>
</head>
<body class="text-slate-800 min-h-screen text-pretty">

    <!-- Return to Home Button -->
    <a href="index.html" class="fixed top-4 left-4 z-50 bg-white/90 backdrop-blur-sm text-amber-600 px-4 py-2 rounded-full shadow-lg border border-amber-100 font-bold text-sm flex items-center gap-2 tap hover:bg-white transition-all">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        è¿”å›å®˜ç¶²
    </a>

    <!-- Header -->
    <header class="bg-amber-600 text-white pt-8 pb-24 rounded-b-[3.5rem] shadow-xl relative overflow-hidden text-center px-4">
        <!-- è£é£¾èƒŒæ™¯ -->
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0 pointer-events-none">
            <div class="absolute -top-10 -left-10 w-40 h-40 bg-white/10 rounded-full blur-2xl"></div>
            <div class="absolute top-10 -right-10 w-60 h-60 bg-amber-400/20 rounded-full blur-3xl"></div>
        </div>

        <div class="max-w-md mx-auto relative z-10 flex flex-col items-center">

            <!-- å…¨æ–°è¨­è¨ˆçš„ Logo å€å¡Š (å«å½©è›‹è§¸ç™¼å™¨) -->
            <div class="relative group logo-float mb-1 select-none">
                <!-- 1. å‘¼å¸å…‰æšˆ (Glow) -->
                <div class="absolute -inset-2 bg-gradient-to-tr from-amber-200 to-pink-300 rounded-full blur opacity-40 animate-pulse group-hover:opacity-70 transition duration-500"></div>

                <!-- 2. åœ“å½¢å®¹å™¨ + é‚Šæ¡† -->
                <div class="relative w-28 h-28 bg-white p-1.5 rounded-full shadow-[0_10px_30px_-5px_rgba(0,0,0,0.2)] flex items-center justify-center border-4 border-white/40 backdrop-blur-sm">
                    <!-- åœ–ç‰‡ -->
                    <img src="https://i.meee.com.tw/DJ2LV4B.jpg" alt="Dora Beauty Logo" class="w-full h-full object-cover rounded-full border border-slate-100">
                </div>

                <!-- 3. å°ˆæ¥­æ„›å¿ƒå¾½ç«  (å½©è›‹é–‹é—œ) -->
                <button id="easter-egg-btn" onclick="triggerLoveEgg(event)" class="absolute -bottom-2 -right-2 bg-gradient-to-br from-pink-500 to-rose-500 text-white p-2.5 rounded-full shadow-lg border-[3px] border-amber-600 flex items-center justify-center transform active:scale-90 hover:scale-110 transition-all duration-200 cursor-pointer z-20 outline-none ring-0 touch-manipulation">
                     <svg id="heart-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor" class="transition-transform duration-300"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                </button>
            </div>

            <!-- ç‹€æ…‹æ¨™ç±¤ -->
            <div id="status-msg" class="inline-block px-5 py-1 bg-black/15 rounded-full text-[10px] font-bold uppercase tracking-widest leading-none mt-3 border border-white/10 backdrop-blur-md shadow-sm">ç³»çµ±å°±ç·’</div>
        </div>
    </header>

    <main class="max-w-md mx-auto px-6 -mt-16 pb-20 relative z-20">
        <div class="glass-card rounded-[3rem] p-8 shadow-2xl border border-white/60">

            <!-- å•å€™èªèˆ‡æé†’ -->
            <div class="flex flex-col items-center text-center mb-8 mt-1">
                <div class="w-16 h-16 bg-amber-100 rounded-[1.5rem] flex items-center justify-center text-amber-600 mb-4 shadow-sm border border-amber-200/30">
                    <svg id="greet-icon-svg" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></svg>
                </div>
                <h2 id="big-greet" class="text-2xl font-black text-slate-800 tracking-tight leading-tight mb-3 italic">æ‚¨å¥½ï¼Œè¾›è‹¦çš„åª½åª½</h2>
                <div class="bg-pink-50 p-5 rounded-[2rem] border border-pink-100 shadow-sm flex gap-3 items-start text-left w-full">
                    <div class="bg-pink-500 p-1.5 rounded-full text-white shrink-0 mt-0.5 shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                    </div>
                    <p id="health-tip-content" class="text-sm text-pink-800 font-bold leading-relaxed italic opacity-95">æ­£åœ¨æº–å‚™è²¼å¿ƒæé†’...</p>
                </div>
            </div>

            <!-- åœ°å€è¼¸å…¥ -->
            <div class="search-container mb-10 text-center">
                <div class="flex items-center gap-2 mb-3 ml-2">
                    <span class="w-2.5 h-2.5 bg-amber-500 rounded-full animate-pulse"></span>
                    <p class="text-sm text-slate-500 font-black uppercase tracking-widest leading-none">åˆ°åºœæœå‹™åœ°å€</p>
                </div>
                <input id="addr-val" type="text" placeholder="è¼¸å…¥è·¯åã€ç¤¾å€æˆ–å®Œæ•´åœ°å€..." class="bg-slate-50 border-none rounded-[1.8rem] p-5 text-base font-bold outline-none focus:ring-2 focus:ring-amber-500 shadow-inner text-slate-700 w-full mb-5">
                <button id="main-btn" onclick="handleSearch()" class="w-full bg-slate-800 text-white py-5 rounded-[1.8rem] font-black text-lg tap shadow-lg transition-all disabled:bg-slate-300">
                    é–‹å§‹è²»ç”¨è©¦ç®—
                </button>
            </div>

            <!-- çµæœé¡¯ç¤ºå€ -->
            <div id="res-block" class="hidden mt-10 pt-10 border-t-2 border-dashed border-slate-100 fade-slide-up">
                <div class="bg-slate-900 rounded-[2.5rem] p-8 text-white relative overflow-hidden shadow-2xl border-t-4 border-amber-500">
                    <div class="relative z-10 text-center">
                        <p class="text-amber-400 text-xs font-bold uppercase tracking-widest mb-2">é ä¼°å ±åƒ¹ç¸½é¡</p>
                        <div class="flex items-baseline justify-center gap-1 mb-6">
                            <span class="text-3xl text-amber-300 font-light">$</span>
                            <span id="res-total" class="text-6xl font-black tracking-tighter">0</span>
                        </div>

                        <div class="space-y-4 border-t border-white/10 pt-6 text-sm text-left">
                            <div class="flex justify-between items-center text-slate-400 font-bold tracking-tight">
                                <span>åŸºæœ¬æœå‹™è²»</span>
                                <span class="text-slate-100 font-black text-base">$2,000</span>
                            </div>
                            <div class="flex justify-between items-center text-slate-400 font-bold tracking-tight">
                                <span>é‡Œç¨‹è»Šé¦¬è²» (<span id="res-dist" class="text-amber-400">0</span>km)</span>
                                <span class="text-amber-400 font-black text-base">+$<span id="res-travel-fee">0</span></span>
                            </div>
                            <div class="bg-white/5 p-4 rounded-[1.5rem] mt-4 leading-relaxed border border-white/5 shadow-inner">
                                <span class="text-amber-500 font-black text-xs uppercase block mb-1 tracking-widest">ğŸ“ é ç´„åœ°é»</span>
                                <div id="res-addr-container">
                                     <span id="res-addr" class="text-white font-bold text-base break-words">--</span>
                                </div>
                                <div id="map-preview" class="w-full h-48 rounded-xl mt-4 bg-slate-800 hidden border border-white/10"></div>
                            </div>
                        </div>

                        <div class="flex flex-col gap-3 mt-8">
                            <button id="next-step-btn" onclick="openFormModal()" class="bg-amber-500 text-white py-5 rounded-2xl flex items-center justify-center gap-3 tap shadow-lg transition-all hover:bg-amber-400 w-full">
                                <span class="text-lg font-black tracking-widest">ä¸‹ä¸€æ­¥ï¼šå¡«å¯«è«®è©¢è¡¨å–®</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è²»ç”¨èªªæ˜å€å¡Š -->
        <div class="mt-8 p-6 bg-amber-50 rounded-[2.5rem] border border-amber-100 shadow-sm px-8">
            <p class="text-xs text-amber-900 font-black mb-4 italic flex items-center gap-2 uppercase tracking-widest">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                æœå‹™è²»è¨ˆè²»è©³æƒ…
            </p>
            <ul class="text-sm text-amber-800 font-bold space-y-4 opacity-90 leading-relaxed">
                <li class="flex justify-between items-center"><span>åŸºæœ¬åˆ°åºœæœå‹™è²»</span><span class="text-amber-600 font-black">$2,000</span></li>
                <li class="flex justify-between items-center border-t border-amber-200/50 pt-4"><span>ä¾†å›é‡Œç¨‹ 10km å…§</span><span class="text-emerald-600 font-black font-black">å…æ”¶è»Šé¦¬è²»</span></li>
                <li class="flex justify-between items-center"><span>ä¾†å›é‡Œç¨‹ 10-20km</span><span class="text-amber-600 font-black">åŠ æ”¶ $100</span></li>
                <li class="flex justify-between items-center border-b border-amber-200/50 pb-4"><span>ä¾†å›é‡Œç¨‹ 20-30km</span><span class="text-amber-600 font-black">åŠ æ”¶ $200</span></li>
                <li class="text-[10px] text-slate-400 font-medium pt-2 text-center italic">â€» è¨»ï¼šè¶…é 10 å…¬é‡Œå¾Œï¼Œæ¯ 10 å…¬é‡ŒåŠ æ”¶ $100 å…ƒï¼Œä»¥æ­¤é¡æ¨ã€‚</li>
            </ul>
        </div>

        <!-- å¿«é€Ÿè¯ç¹«å€å¡Š -->
        <div class="mt-6 grid grid-cols-2 gap-4">
            <a href="tel:0932122542" class="bg-white p-4 rounded-[2rem] shadow-sm border border-slate-100 flex flex-col items-center justify-center gap-2 tap transition-transform active:scale-95">
                <div class="bg-slate-100 p-3 rounded-full text-slate-600">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                </div>
                <span class="text-xs font-black text-slate-600">æ’¥æ‰“é›»è©±</span>
            </a>
            <a href="https://line.me/R/ti/p/@bmy3560l" target="_blank" class="bg-white p-4 rounded-[2rem] shadow-sm border border-slate-100 flex flex-col items-center justify-center gap-2 tap transition-transform active:scale-95">
                <div class="bg-[#06C755]/10 p-3 rounded-full text-[#06C755]">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M24 10.304c0-4.587-4.825-8.317-10.764-8.317-5.938 0-10.764 3.73-10.764 8.317 0 4.108 3.821 7.545 8.995 8.21 0.35 0.075 0.825 0.231 0.945 0.531 0.108 0.273 0.071 0.7 0.035 0.976 0 0-0.128 0.772-0.156 0.938-0.047 0.272-0.219 1.065 0.944 0.582 1.163-0.483 6.279-3.698 8.564-6.335 1.564-1.801 2.205-3.555 2.205-4.902z"/></svg>
                </div>
                <span class="text-xs font-black text-slate-600">åŠ  LINE å¥½å‹</span>
            </a>
        </div>
    </main>

    <!-- è«®è©¢è¡¨å–® Modal -->
    <div id="form-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm hidden z-[9999] overflow-hidden">
        <div class="absolute inset-0 overflow-y-auto no-scrollbar py-10 px-4">
            <div class="bg-white rounded-[2.5rem] w-full max-w-lg mx-auto modal-animate shadow-2xl relative min-h-[80vh]">

                <!-- Modal Header -->
                <div class="bg-amber-600 p-6 rounded-t-[2.5rem] flex justify-between items-center shadow-md">
                    <div>
                        <h3 class="text-white text-xl font-black">å¡«å¯«è«®è©¢è³‡æ–™</h3>
                        <p class="text-amber-200 text-xs mt-1">Information Form</p>
                    </div>
                    <button onclick="closeFormModal()" class="bg-black/20 text-white p-2 rounded-full hover:bg-black/30 tap">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </div>

                <!-- éš±ç§æ¬Šè²æ˜ -->
                <div class="bg-amber-50 px-6 py-4 border-b border-amber-100">
                    <p class="text-[10px] text-amber-800 leading-relaxed font-bold flex gap-2">
                        <svg class="shrink-0" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        å€‹è³‡ä¿è­·è²æ˜ï¼šæœ¬è¡¨å–®è³‡æ–™åƒ…ä¾› DoraBeauty æœå‹™è©•ä¼°èˆ‡è¯ç¹«ä½¿ç”¨ï¼Œçµ•ä¸å¤–æ´©ï¼Œè«‹åª½å’ªæ”¾å¿ƒå¡«å¯«ã€‚
                    </p>
                </div>

                <!-- Form Content -->
                <div class="p-6 sm:p-8 space-y-8">

                    <!-- 1. åŸºæœ¬è³‡æ–™ -->
                    <div class="space-y-4">
                        <h4 class="section-title">
                            <span class="w-1.5 h-5 bg-amber-500 rounded-full"></span> 1. åª½å’ªåŸºæœ¬è³‡æ–™
                        </h4>
                        <div>
                            <label class="form-label">è«‹å•åª½å’ªçš„å§“åï¼Ÿ</label>
                            <input type="text" id="f-name" class="form-input" placeholder="ä¾‹å¦‚ï¼šç‹å°ç¾">
                        </div>
                        <div>
                            <label class="form-label">è¯çµ¡é›»è©±ï¼Ÿ</label>
                            <input type="tel" id="f-phone" class="form-input" placeholder="09xx-xxx-xxx">
                        </div>
                    </div>

                    <!-- 2. ç”Ÿç”¢è³‡è¨Š (ä¿®æ­£å€å¡Š) -->
                    <div class="space-y-4">
                        <h4 class="section-title">
                            <span class="w-1.5 h-5 bg-amber-500 rounded-full"></span> 2. ç”Ÿç”¢èˆ‡å“ºä¹³ç¶“é©—
                        </h4>
                        <!-- ç¶­æŒæ‰‹æ©Ÿå‚ç›´æ’åˆ—ï¼Œç¢ºä¿ä¸é‡ç–Š -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="w-full min-w-0"> <!-- åŠ å…¥ min-w-0 é˜²æ­¢ grid item æº¢å‡º -->
                                <label class="form-label">ç”Ÿç”¢æ—¥æœŸ</label>
                                <!-- ç§»é™¤ inline styleï¼Œæ”¹ç”¨ Tailwind class ç¢ºä¿å¯¬åº¦ä¸€è‡´ -->
                                <input type="date" id="f-birthdate" class="form-input w-full max-w-full">
                            </div>
                            <div class="w-full min-w-0">
                                <label class="form-label">ç”Ÿç”¢æ–¹å¼</label>
                                <select id="f-method" class="form-input w-full max-w-full">
                                    <option value="è‡ªç„¶ç”¢">è‡ªç„¶ç”¢</option>
                                    <option value="å‰–è…¹ç”¢">å‰–è…¹ç”¢</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="form-label">é€™æ˜¯ç¬¬å¹¾èƒï¼Ÿ</label>
                            <input type="text" id="f-parity" class="form-input" placeholder="ä¾‹å¦‚ï¼š1">
                        </div>
                        <div>
                            <label class="form-label">ä¹‹å‰çš„å“ºä¹³ç¶“é©—å¦‚ä½•ï¼Ÿ</label>
                            <textarea id="f-exp" class="form-input h-20 resize-none" placeholder="ä¾‹å¦‚ï¼šç¬¬ä¸€èƒè¦ªé¤µå¾ˆé †åˆ©ï¼Œæˆ–é€™æ˜¯ç¬¬ä¸€èƒç„¡ç¶“é©—"></textarea>
                        </div>
                    </div>

                    <!-- 3. åœ°é»è³‡è¨Š -->
                    <div class="space-y-4">
                        <h4 class="section-title">
                            <span class="w-1.5 h-5 bg-amber-500 rounded-full"></span> 3. æ‰€åœ¨ä½ç½®
                        </h4>
                        <div>
                            <label class="form-label">ç”Ÿç”¢é†«é™¢</label>
                            <input type="text" id="f-hospital" class="form-input" placeholder="ä¾‹å¦‚ï¼šä¸­åœ‹é™„é†«">
                        </div>
                        <div>
                            <label class="form-label">æœˆå­ä¸­å¿ƒ (è‹¥åœ¨å®¶è«‹ç•™ç©º)</label>
                            <input type="text" id="f-center" class="form-input" placeholder="ä¾‹å¦‚ï¼šæ²ç¾ç”¢å¾Œè­·ç†ä¹‹å®¶">
                        </div>
                        <div>
                            <label class="form-label">éœ€è¦å”åŠ©çš„åœ°å€ (å¯ä¿®æ”¹)</label>
                            <textarea id="f-address" class="form-input h-20 resize-none"></textarea>
                        </div>
                    </div>

                    <!-- 4. å¯¶å¯¶è³‡è¨Š -->
                    <div class="space-y-4">
                        <h4 class="section-title">
                            <span class="w-1.5 h-5 bg-amber-500 rounded-full"></span> 4. å¯¶å¯¶è³‡è¨Š
                        </h4>
                        <!-- åŒæ­¥ä¿®æ­£ï¼šæ‰‹æ©Ÿç‰ˆå‚ç›´æ’åˆ— -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label">å‡ºç”Ÿé«”é‡</label>
                                <input type="text" id="f-birth-weight" class="form-input" placeholder="ä¾‹å¦‚ï¼š3000g">
                            </div>
                            <div>
                                <label class="form-label">ç›®å‰é«”é‡</label>
                                <input type="text" id="f-current-weight" class="form-input" placeholder="ä¾‹å¦‚ï¼š3200g">
                            </div>
                        </div>
                    </div>

                    <!-- 5. é¤µå¥¶ç‹€æ³ -->
                    <div class="space-y-4">
                        <h4 class="section-title">
                            <span class="w-1.5 h-5 bg-amber-500 rounded-full"></span> 5. ç›®å‰é¤µå¥¶æ–¹å¼ (é¸å¡«)
                        </h4>
                        <!-- æ‰‹æ“ ä¹³å€å¡Š -->
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                            <p class="text-xs font-bold text-slate-400 mb-3 uppercase tracking-wider">A. è‹¥æœ‰æ‰‹æ“ ä¹³</p>
                            <div class="grid grid-cols-2 gap-3">
                                <input type="text" id="f-hand-freq" class="form-input text-sm" placeholder="é »ç‡ (å¹¾å°æ™‚ä¸€æ¬¡)">
                                <input type="text" id="f-hand-vol" class="form-input text-sm" placeholder="ä¸€æ¬¡æ“ å¥¶é‡ (cc)">
                            </div>
                        </div>
                        <!-- è¦ªé¤µå€å¡Š -->
                        <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                            <p class="text-xs font-bold text-slate-400 mb-3 uppercase tracking-wider">B. è‹¥æœ‰è¦ªé¤µ</p>
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <input type="text" id="f-latch-freq" class="form-input text-sm" placeholder="é »ç‡ (å¹¾å°æ™‚ä¸€æ¬¡)">
                                <input type="text" id="f-latch-duration" class="form-input text-sm" placeholder="ä¸€æ¬¡é¤µå¤šä¹… (åˆ†é˜)">
                            </div>
                            <input type="text" id="f-latch-feeling" class="form-input text-sm" placeholder="è¦ªé¤µæ„Ÿè¦º (ç—›/é †åˆ©/å¯¶å¯¶ä¸å«ä¹³)">
                        </div>
                    </div>

                    <!-- 6. éœ€æ±‚å”åŠ© -->
                    <div class="space-y-4">
                        <h4 class="section-title">
                            <span class="w-1.5 h-5 bg-amber-500 rounded-full"></span> 6. ç›®å‰éœ€è¦å”åŠ©çš„å•é¡Œ
                        </h4>
                        <div>
                            <label class="form-label">è«‹æè¿°ç›®å‰ç‹€æ³</label>
                            <textarea id="f-issue" class="form-input h-24 resize-none" placeholder="ä¾‹å¦‚ï¼šå¡å¥¶ç¡¬å¡Šæ¨ä¸é–‹ã€ä¹³é ­ç ´çš®ç–¼ç—›..."></textarea>
                        </div>
                    </div>

                </div>

                <!-- Footer Actions -->
                <div class="p-6 border-t border-slate-100 flex flex-col gap-2 rounded-b-[2.5rem]">
                     <button onclick="submitFormToLine()" class="w-full bg-[#06C755] text-white py-4 rounded-2xl flex items-center justify-center gap-2 tap shadow-lg hover:bg-[#05b34c] transition-all">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor" class="shrink-0"><path d="M24 10.304c0-4.587-4.825-8.317-10.764-8.317-5.938 0-10.764 3.73-10.764 8.317 0 4.108 3.821 7.545 8.995 8.21 0.35 0.075 0.825 0.231 0.945 0.531 0.108 0.273 0.071 0.7 0.035 0.976 0 0-0.128 0.772-0.156 0.938-0.047 0.272-0.219 1.065 0.944 0.582 1.163-0.483 6.279-3.698 8.564-6.335 1.564-1.801 2.205-3.555 2.205-4.902z"/></svg>
                        <span class="text-lg font-black tracking-widest">è¤‡è£½è³‡æ–™ä¸¦é–‹å•Ÿ LINE</span>
                    </button>
                    <p class="text-[10px] text-slate-400 text-center">è«‹æ–¼ LINE èŠå¤©å®¤ã€Œè²¼ä¸Šã€å‚³é€å³å¯</p>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center text-slate-300 text-xs tracking-[0.4em] uppercase py-12 font-black px-4">
        Dora Beauty Maternal Pro v18.9
    </footer>

    <!-- é¼“å‹µå°èª Toast å®¹å™¨ -->
    <div id="toast-container" class="fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] flex flex-col gap-2 items-center pointer-events-none w-full max-w-sm px-4"></div>

    <script>
        const GOOGLE_API_KEY = "AIzaSyAXSGaFCS3VcYghu3rUh4nmogf0qwJCuCo";
        const CONFIG = {
            brandName: "Dora Beauty",
            lineId: "bmy3560l",
            servicePhone: "0932122542",
            storeLocation: "å—æŠ•ç¸£ä¸­å¯®é„‰æ°¸ç¦æ‘10é„°æ°¸å˜‰æ–°æ‘23å··2å¼„38è™Ÿ",
            storeLat: 23.895275, storeLng: 120.733264,
            baseServiceFee: 2000, stepPrice: 100, freeAllowanceKm: 10
        };

        const MATERNAL_TIPS = [
            "æ”¾é¬†å¿ƒæƒ…æ˜¯å¹«åŠ©ä¹³æ±åˆ†æ³Œçš„æœ€ä½³è‰¯è—¥ï¼Œåª½åª½è¾›è‹¦äº†ï¼Œè¨˜å¾—å¤šæ·±å‘¼å¸å”·ï¼",
            "æ­£ç¢ºçš„å«ä¹³å§¿å‹¢å¯ä»¥é¿å…ä¹³é ­å—å‚·ï¼Œè®“å“ºé¤µéç¨‹æ›´é †åˆ©ã€æ›´èˆ’é©ã€‚",
            "ç”¢å¾Œè¨˜å¾—å¤šè£œå……æ°´åˆ†ï¼Œæº«é–‹æ°´å°èº«é«”ä¿®å¾©èˆ‡æ¯ä¹³è£½é€ éå¸¸æœ‰å¹«åŠ©ã€‚"
        ];

        // æš–å¿ƒé¼“å‹µèªéŒ„ (å½©è›‹ç”¨)
        const LOVE_QUOTES = [
            "åª½å’ªï¼Œæ‚¨å·²ç¶“åšå¾—å¾ˆæ£’äº†ï¼â¤ï¸",
            "å› ç‚ºæœ‰æ‚¨ï¼Œå¯¶å¯¶å¾ˆå¹¸ç¦å–”ï¼ğŸ‘¶",
            "è¨˜å¾—è¦çµ¦è‡ªå·±ä¸€å€‹å¤§å¤§çš„æ“æŠ±ï¼ğŸ«‚",
            "æ‚¨çš„æ¯æ„›æ˜¯ä¸–ç•Œä¸Šæœ€æº«æŸ”çš„åŠ›é‡ âœ¨",
            "ç´¯çš„æ™‚å€™ä¼‘æ¯ä¸€ä¸‹æ²’é—œä¿‚çš„ ğŸŒ™",
            "ä»Šå¤©ä¹Ÿè¦æ„›è‡ªå·±å¤šä¸€é»å–”ï¼ğŸ’–"
        ];

        let geocoder, distanceService, isGoogleReady = false;
        let calculationResult = {
            dist: 0, fee: 0, total: 0, rawAddress: "", source: ""
        };

        // --- å½©è›‹åŠŸèƒ½é‚è¼¯ ---
        function triggerLoveEgg(e) {
            e.stopPropagation(); // é˜²æ­¢å†’æ³¡

            // 1. æŒ‰éˆ•å‹•ç•«
            const btn = document.getElementById('easter-egg-btn');
            const icon = document.getElementById('heart-icon');
            icon.style.transform = "scale(1.4)";
            setTimeout(() => icon.style.transform = "scale(1)", 200);

            // 2. ç”¢ç”Ÿéš¨æ©Ÿé¼“å‹µå°èª (Toast)
            const quote = LOVE_QUOTES[Math.floor(Math.random() * LOVE_QUOTES.length)];
            showLoveToast(quote);

            // 3. ç”¢ç”Ÿæ„›å¿ƒé›¨
            createHeartRain();
        }

        function showLoveToast(msg) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'bg-white/90 backdrop-blur-md text-pink-600 px-6 py-3 rounded-full shadow-xl border border-pink-100 font-bold text-sm tracking-wide toast-enter flex items-center gap-2';
            toast.innerHTML = `<span class="text-xl">ğŸ’</span> ${msg}`;

            container.appendChild(toast);

            // å‹•ç•«é€²å ´
            requestAnimationFrame(() => {
                toast.classList.remove('toast-enter');
                toast.classList.add('toast-enter-active');
            });

            // 3ç§’å¾Œæ¶ˆå¤±
            setTimeout(() => {
                toast.classList.remove('toast-enter-active');
                toast.classList.add('toast-exit-active');
                setTimeout(() => toast.remove(), 300);
            }, 2500);
        }

        function createHeartRain() {
            const heartColors = ['#ec4899', '#f43f5e', '#fb7185', '#fda4af', '#e11d48'];
            const heartSymbols = ['â¤', 'ğŸ’—', 'ğŸ’–', 'âœ¨', 'ğŸŒ¸'];

            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.className = 'heart-particle';
                    heart.innerText = heartSymbols[Math.floor(Math.random() * heartSymbols.length)];
                    heart.style.color = heartColors[Math.floor(Math.random() * heartColors.length)];
                    heart.style.left = Math.random() * 100 + 'vw';
                    heart.style.bottom = '-20px';
                    // éš¨æ©Ÿå¤§å°èˆ‡é€Ÿåº¦
                    const size = Math.random() * 1.5 + 1 + 'rem';
                    const duration = Math.random() * 2 + 3 + 's';
                    heart.style.fontSize = size;
                    heart.style.animationDuration = duration;

                    document.body.appendChild(heart);

                    // å‹•ç•«çµæŸå¾Œç§»é™¤
                    setTimeout(() => heart.remove(), 5000);
                }, i * 100); // éŒ¯é–‹ç”Ÿæˆæ™‚é–“
            }
        }

        // --- ä»¥ä¸‹ç‚ºåŸæœ‰é‚è¼¯ ---

        window.initGoogleServices = function() {
            try {
                geocoder = new google.maps.Geocoder();
                distanceService = new google.maps.DistanceMatrixService();
                new google.maps.places.Autocomplete(document.getElementById('addr-val'), {
                    componentRestrictions: { country: "tw" },
                    fields: ["formatted_address", "geometry"]
                });
                isGoogleReady = true; updateStatus("ç³»çµ±å°±ç·’");
            } catch (e) { updateStatus("ç›®å‰ç‚ºå‚™ç”¨æ¨¡å¼"); }
        };

        window.handleSearch = () => {
            const rawVal = document.getElementById('addr-val').value.trim();
            if (!rawVal) return alert("è«‹è¼¸å…¥åœ°å€");
            const btn = document.getElementById('main-btn');
            btn.disabled = true; btn.innerHTML = '<span class="loader"></span> æ­£åœ¨è©¦ç®—è·¯å¾‘...';

            if (isGoogleReady && geocoder) {
                geocoder.geocode({ address: rawVal, componentRestrictions: { country: 'tw' } }, (results, status) => {
                    if (status === "OK" && results[0]) {
                        calculateGoogleDistance(results[0].geometry.location, results[0].formatted_address);
                    } else { useBackupSearch(rawVal); }
                });
            } else { useBackupSearch(rawVal); }
        };

        async function useBackupSearch(rawInput) {
            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(rawInput)}&limit=1`);
                const data = await res.json();
                if (data && data.length > 0) {
                    calculateStandardDistance(parseFloat(data[0].lat), parseFloat(data[0].lon), rawInput);
                } else { resetBtn(); alert("æ‰¾ä¸åˆ°è©²åœ°å€ã€‚"); }
            } catch (e) { resetBtn(); alert("é€£ç·šä¸ç©©ã€‚"); }
        }

        function calculateGoogleDistance(destLatLng, rawInput) {
            distanceService.getDistanceMatrix({
                origins: [{ lat: CONFIG.storeLat, lng: CONFIG.storeLng }],
                destinations: [destLatLng],
                travelMode: google.maps.TravelMode.DRIVING,
                unitSystem: google.maps.UnitSystem.METRIC,
            }, (response, status) => {
                resetBtn();
                if (status === "OK" && response.rows[0].elements[0].status === "OK") {
                    let distanceKm = response.rows[0].elements[0].distance.value / 1000;
                    if (distanceKm < 1.5 || rawInput.includes("æ°¸å˜‰æ–°æ‘")) distanceKm = 0;
                    showResult(parseFloat((distanceKm * 2).toFixed(1)), rawInput, "Google Maps", destLatLng);
                } else { calculateStandardDistance(destLatLng.lat(), destLatLng.lng(), rawInput); }
            });
        }

        function calculateStandardDistance(lat, lng, rawInput) {
            const R = 6371;
            const dLat = (lat - CONFIG.storeLat) * Math.PI / 180;
            const dLng = (lng - CONFIG.storeLng) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(CONFIG.storeLat * Math.PI / 180) * Math.cos(lat * Math.PI / 180) * Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            let d = R * c;
            if (d < 1.5 || rawInput.includes("æ°¸å˜‰æ–°æ‘")) d = 0;
            const roundTrip = parseFloat((d * 1.4 * 2).toFixed(1));
            resetBtn();
            showResult(roundTrip, rawInput, "å‚™ç”¨æ©Ÿåˆ¶", {lat: lat, lng: lng});
        }

        function showResult(dist, rawInput, source, location) {
            let travelFee = 0;
            if (dist > CONFIG.freeAllowanceKm) { travelFee = Math.ceil((dist - CONFIG.freeAllowanceKm) / 10) * CONFIG.stepPrice; }
            const total = 2000 + travelFee;
            calculationResult = { dist, fee: travelFee, total, rawAddress: rawInput, source };

            document.getElementById('res-block').classList.remove('hidden');
            document.getElementById('res-total').innerText = total.toLocaleString();
            document.getElementById('res-dist').innerText = dist;
            document.getElementById('res-travel-fee').innerText = travelFee;

            let badgeClass = source === "Google Maps" ? "text-emerald-400 border-emerald-500/30 bg-emerald-500/10" : "text-amber-400 border-amber-500/30 bg-amber-500/10";
            let badgeHtml = `<span class="inline-block ml-2 text-[10px] px-2 py-0.5 rounded-full border ${badgeClass} align-middle tracking-wider">${source}</span>`;
            document.getElementById('res-addr').innerHTML = rawInput + badgeHtml;
            document.getElementById('res-block').scrollIntoView({ behavior: 'smooth' });

            const mapDiv = document.getElementById('map-preview');
            if (mapDiv && location && window.google && window.google.maps) {
                mapDiv.classList.remove('hidden');
                const map = new google.maps.Map(mapDiv, {
                    center: location,
                    zoom: 15,
                    disableDefaultUI: true,
                    styles: [
                        { elementType: "geometry", stylers: [{ color: "#242f3e" }] },
                        { elementType: "labels.text.stroke", stylers: [{ color: "#242f3e" }] },
                        { elementType: "labels.text.fill", stylers: [{ color: "#746855" }] },
                        { featureType: "road", elementType: "geometry", stylers: [{ color: "#38414e" }] },
                        { featureType: "road", elementType: "geometry.stroke", stylers: [{ color: "#212a37" }] },
                        { featureType: "road", elementType: "labels.text.fill", stylers: [{ color: "#9ca5b3" }] }
                    ]
                });
                new google.maps.Marker({ position: location, map: map });
            }
        }

        function resetBtn() {
            const btn = document.getElementById('main-btn');
            btn.disabled = false; btn.innerText = 'é–‹å§‹è²»ç”¨è©¦ç®—';
        }

        function updateStatus(msg) { document.getElementById('status-msg').innerText = msg; }

        window.openFormModal = () => {
            if (calculationResult.total === 0) return alert("è«‹å…ˆå®Œæˆåœ°å€è©¦ç®—ï¼");
            document.getElementById('f-address').value = calculationResult.rawAddress;
            const modal = document.getElementById('form-modal');
            modal.classList.remove('hidden'); modal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        };

        window.closeFormModal = () => {
            const modal = document.getElementById('form-modal');
            modal.classList.add('hidden'); modal.classList.remove('flex');
            document.body.style.overflow = '';
        };

        window.submitFormToLine = () => {
            const nameEl = document.getElementById('f-name');
            const phoneEl = document.getElementById('f-phone');
            const name = nameEl.value.trim();
            const phoneRaw = phoneEl.value.replace(/-/g, '').trim();

            // é‡ç½®éŒ¯èª¤æ¨£å¼
            nameEl.classList.remove('border-red-500', 'bg-red-50');
            phoneEl.classList.remove('border-red-500', 'bg-red-50');

            let isValid = true;
            if (!name) {
                nameEl.classList.add('border-red-500', 'bg-red-50');
                isValid = false;
            }
            // æª¢æŸ¥é›»è©±ï¼šå¿…é ˆç‚º 09 é–‹é ­ä¸”ç¸½é•·åº¦ç‚º 10 ç¢¼ (å»é™¤å»è™Ÿå¾Œ)
            if (!phoneRaw || !/^09\d{8}$/.test(phoneRaw)) {
                phoneEl.classList.add('border-red-500', 'bg-red-50');
                isValid = false;
            }

            if (!isValid) {
                alert("è«‹æª¢æŸ¥ã€Œå§“åã€å¿…å¡«ï¼Œä¸”ã€Œè¯çµ¡é›»è©±ã€æ ¼å¼æ­£ç¢ºå–”ï¼(éœ€ç‚º 09 é–‹é ­æ‰‹æ©Ÿè™Ÿç¢¼)");
                return;
            }

            const phone = phoneEl.value.trim();
            const birthDate = document.getElementById('f-birthdate').value;
            const method = document.getElementById('f-method').value;
            const parity = document.getElementById('f-parity').value;
            const exp = document.getElementById('f-exp').value;
            const hospital = document.getElementById('f-hospital').value;
            const center = document.getElementById('f-center').value;
            const finalAddress = document.getElementById('f-address').value;
            const issue = document.getElementById('f-issue').value;
            const latchFeeling = document.getElementById('f-latch-feeling').value;

            // --- ä¿®æ­£é–‹å§‹ï¼šè‡ªå‹•è£œä¸Šå–®ä½é‚è¼¯ ---

            // å®šç¾©ä¸€å€‹å°å¹«æ‰‹å‡½å¼ï¼šå¦‚æœå…§å®¹åªæœ‰æ•¸å­—ï¼Œå°±åŠ ä¸ŠæŒ‡å®šçš„å–®ä½
            const addUnit = (val, unit) => {
                if (!val) return 'æœªå¡«';
                const strVal = String(val).trim();
                // æ­£è¦è¡¨é”å¼ï¼šæª¢æŸ¥æ˜¯å¦åªåŒ…å«æ•¸å­—å’Œå°æ•¸é»
                if (/^[\d.]+$/.test(strVal)) {
                    return strVal + unit;
                }
                return strVal;
            };

            // å–å¾—æ¬„ä½å€¼ä¸¦å¥—ç”¨å–®ä½
            const f_birthWeight = addUnit(document.getElementById('f-birth-weight').value, 'g');
            const f_currentWeight = addUnit(document.getElementById('f-current-weight').value, 'g');

            const f_handFreq = addUnit(document.getElementById('f-hand-freq').value, 'å°æ™‚ä¸€æ¬¡');
            const f_handVol = addUnit(document.getElementById('f-hand-vol').value, 'cc');

            const f_latchFreq = addUnit(document.getElementById('f-latch-freq').value, 'å°æ™‚ä¸€æ¬¡');
            const f_latchDuration = addUnit(document.getElementById('f-latch-duration').value, 'åˆ†é˜');

            let feedingDesc = "";

            // è™•ç†æ‰‹æ“ ä¹³è³‡è¨Š
            if (f_handFreq !== 'æœªå¡«' || f_handVol !== 'æœªå¡«') {
                feedingDesc += `\n   â€¢ æ‰‹æ“ ä¹³ï¼šé »ç‡ã€Œ${f_handFreq}ã€ï¼Œå¥¶é‡ã€Œ${f_handVol}ã€`;
            }

            // è™•ç†è¦ªé¤µè³‡è¨Š
            if (f_latchFreq !== 'æœªå¡«' || f_latchDuration !== 'æœªå¡«' || latchFeeling) {
                feedingDesc += `\n   â€¢ è¦ªé¤µï¼šé »ç‡ã€Œ${f_latchFreq}ã€ï¼Œæ™‚é–“ã€Œ${f_latchDuration}ã€ï¼Œæ„Ÿå—ã€Œ${latchFeeling || 'æœªå¡«'}ã€`;
            }

            if (!feedingDesc) feedingDesc = "å°šæœªå¡«å¯«";
            // --- ä¿®æ­£çµæŸ ---

            const finalMessage = `æ‚¨å¥½ï¼Œæˆ‘æƒ³é ç´„æ³Œä¹³æœå‹™ï¼\n\nã€DoraBeauty è«®è©¢è³‡æ–™è¡¨ã€‘\n1. åª½å’ªè³‡æ–™\nğŸ‘¤ å§“åï¼š${name}\nğŸ“ é›»è©±ï¼š${phone}\n\n2. ç”Ÿç”¢è³‡è¨Š\nğŸ“… æ—¥æœŸï¼š${birthDate || 'æœªå¡«'}\nğŸ¥ æ–¹å¼ï¼š${method} / ç¬¬ ${parity || '?'} èƒ\nğŸ¼ ç¶“é©—ï¼š${exp || 'ç„¡'}\n\n3. åœ°é»\nğŸ  åœ°å€ï¼š${finalAddress} (${calculationResult.source})\nğŸ¥ é†«é™¢ï¼š${hospital || 'æœªå¡«'}\nğŸ¨ æœˆä¸­ï¼š${center || 'ç„¡'}\n\n4. å¯¶å¯¶èˆ‡é¤µå¥¶\nğŸ‘¶ é«”é‡ï¼šå‡ºç”Ÿ ${f_birthWeight}/ ç›®å‰ ${f_currentWeight}\nğŸ¥› é¤µå¥¶æ–¹å¼ï¼š${feedingDesc}\n\n5. éœ€æ±‚å”åŠ©\nâ“ ç‹€æ³ï¼š${issue || 'ç•¶é¢èªªæ˜'}\n\n-------------------\nã€è²»ç”¨è©¦ç®—çµæœã€‘\nğŸš— é ä¼°è·¯ç¨‹ï¼š${calculationResult.dist} km\nğŸ’° è©¦ç®—ç¸½é¡ï¼š$${calculationResult.total.toLocaleString()}\n(å«åŸºæœ¬è²» $2,000 + è»Šé¦¬è²» $${calculationResult.fee})\n\nâ€» è³‡æ–™åƒ…ä¾›è©•ä¼°ä½¿ç”¨ï¼Œå¯¦éš›å ±åƒ¹ä»¥è€å¸«ç¢ºèªç‚ºä¸»ã€‚`;

            const fallbackCopy = (text) => {
                const el = document.createElement('textarea');
                el.value = text;
                el.setAttribute('readonly', '');
                el.style.position = 'absolute'; el.style.left = '-9999px';
                document.body.appendChild(el);
                el.select(); el.setSelectionRange(0, 99999);
                document.execCommand('copy');
                document.body.removeChild(el);
            };

            const proceed = () => {
                closeFormModal();
                const cleanId = CONFIG.lineId.replace('@','');
                const encodedMsg = encodeURIComponent(finalMessage);
                const autoFillUrl = `https://line.me/R/oaMessage/@${cleanId}/?${encodedMsg}`;

                if (confirm("è³‡æ–™å·²è¤‡è£½ï¼\n\nç³»çµ±å°‡å˜—è©¦è‡ªå‹•å¸¶å…¥è¨Šæ¯è‡³ LINEã€‚\n\nè‹¥ LINE é–‹å•Ÿå¾Œæ–‡å­—æœªå‡ºç¾ï¼Œè«‹ç›´æ¥åœ¨å°è©±æ¡†ã€Œè²¼ä¸Šã€å³å¯ã€‚")) {
                    window.location.href = autoFillUrl;
                }
            };

            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(finalMessage)
                    .then(proceed)
                    .catch(() => {
                        fallbackCopy(finalMessage);
                        proceed();
                    });
            } else {
                fallbackCopy(finalMessage);
                proceed();
            }
        };

        function setGreeting() {
            const hour = new Date().getHours();
            const sunPath = `<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>`;
            const moonPath = `<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>`;
            let currentPath = sunPath;
            if (hour >= 5 && hour < 12) document.getElementById('big-greet').innerText = "æ—©å®‰ï¼Œè¾›è‹¦çš„åª½åª½";
            else if (hour >= 12 && hour < 18) document.getElementById('big-greet').innerText = "åˆå®‰ï¼Œå¿™ç¢Œçš„ä¸‹åˆ";
            else { document.getElementById('big-greet').innerText = "æ™šå®‰ï¼Œè¦ªæ„›çš„åª½åª½"; currentPath = moonPath; }
            document.getElementById('greet-icon-svg').innerHTML = currentPath;
        }

        // Auto-save Logic
        const FORM_IDS = [
            'f-name', 'f-phone', 'f-birthdate', 'f-method', 'f-parity',
            'f-exp', 'f-hospital', 'f-center', 'f-address',
            'f-birth-weight', 'f-current-weight', 'f-hand-freq',
            'f-hand-vol', 'f-latch-freq', 'f-latch-duration',
            'f-latch-feeling', 'f-issue'
        ];

        function saveFormState() {
            const data = {};
            FORM_IDS.forEach(id => {
                const el = document.getElementById(id);
                if (el) data[id] = el.value;
            });
            localStorage.setItem('dorabeauty_form_autosave', JSON.stringify(data));
        }

        function loadFormState() {
            const saved = localStorage.getItem('dorabeauty_form_autosave');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    FORM_IDS.forEach(id => {
                        const el = document.getElementById(id);
                        if (el && data[id] !== undefined) el.value = data[id];
                    });
                } catch (e) { console.error("Auto-load failed", e); }
            }
        }

        function initAutoSave() {
            FORM_IDS.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.addEventListener('input', saveFormState);
                    el.addEventListener('change', saveFormState);
                }
            });
        }

        function formatPhoneNumber(e) {
            let val = e.target.value.replace(/\D/g, '');
            if (val.length > 10) val = val.slice(0, 10);
            if (val.length > 4) {
                 val = val.slice(0, 4) + '-' + val.slice(4);
            }
            if (val.length > 8) {
                 val = val.slice(0, 8) + '-' + val.slice(8);
            }
            e.target.value = val;
        }

        function initPhoneFormat() {
            const phoneEl = document.getElementById('f-phone');
            if (phoneEl) {
                phoneEl.addEventListener('input', formatPhoneNumber);
            }
        }

        window.onload = () => {
            loadFormState();
            initAutoSave();
            initPhoneFormat();
            setGreeting();
            document.getElementById('health-tip-content').innerText = MATERNAL_TIPS[Math.floor(Math.random() * MATERNAL_TIPS.length)];
            const script = document.createElement("script");
            script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_API_KEY}&libraries=places&callback=initGoogleServices&language=zh-TW`;
            script.async = true; script.defer = true;
            document.head.appendChild(script);
        };
    </script>
</body>
</html>